
<html>
<head>
<style>
	@font-face{
		font-family: 'OldEnglish';
		src: url('old_english.ttf') format('truetype');
	}
	body{
		font-family: 'OldEnglish';
	}
</style>
</head>
<body>
<h1>Tell me a story...</h1>
<button id='restart' onclick=restart()>Restart</button>
<div id="tell_me_a_story"></div>
<input id="input" style="width:750px;margin:0px;"
	onkeydown="onInputSubmitKeypress(event)" />
<button
	style="width:50px;margin:0px;padding:0px;"
	onclick=onInputSubmit()>
	Write
</button>
<p>
	<h3>How to play!</h3>
	<ul>
		<li>Enter a sentence or two to start the story</li>
		<li>We will write a story based on what you say</li>
		<li>You have control of whatever path the story takes</li>
		<li>Use your words to shapeshift the progress of the story</li>
		<li>Hint: Be <i>extra</i> descriptive to make a more interesting story</li>
		<li>But! if you don't tell us enough information, we will use <b>RANDOM</b> words!</li>
	</ul>
</p>
<script src="phaser.min.js" type="text/javascript"></script>
<script type="text/javascript">
var game = new Phaser.Game(800, 600, Phaser.AUTO, 'tell_me_a_story');

var story = "";

var Menu = function(){};

Menu.prototype = {
	preload : function(){

    game.load.image('start', 'assets/open.png');
    game.load.image('book', 'assets/tmeas_menu.png');
	},

	create : function(){
		this.menu = this.add.sprite(0,0,'book');


		this.button = game.add.button(500, 0, 'start', this.onClick, this, 2, 1, 0);
		this.button.onInputOver.add(this.onOver, this);
		this.button.onInputOut.add(this.onOut, this);
		this.startTime = Date.now();
	},

	update : function(){
	},

	onClick : function(){
		game.state.start('Game');
	},

	onOver : function(){
	},

	onOut : function(){
	}

}

var Game = function(){};

var style = { 
	font: "32px Arial", //OldEnglish, Arial", 
	align: "left", 
	wordWrap: true,
	wordWrapWidth: 700
};

Game.prototype = {
	preload : function(){

    //game.load.image('start', 'assets/open.jpg');
    //game.load.image('book', 'assets/tmeas_menu.png');
	},

	create : function(){
		//this.menu = this.add.sprite(0,0,'Sword');

		game.stage.backgroundColor = 0xfffbdf;

		this.text = game.add.text(50, 50, story, style);


	},

	update : function(){
		this.text.setText(story);
	},

	onClick : function(){
		game.state.start('Main');
	},

	onOver : function(){
	},

	onOut : function(){
	}

}
game.state.add('Menu', Menu);
game.state.add('Game', Game);

game.state.start('Menu');

var addToStory = function(line){
	story += line + "\n";
	console.log(line);
};

var onInputSubmit = function(){
	var input = document.getElementById("input").value;
	document.getElementById("input").value = "";
	addToStory(input);
	getCPUText(input, function(cpuInput){
		addToStory(cpuInput);
	});
};

var onInputSubmitKeypress = function(event){
	if(event.keyCode == 13)onInputSubmit();
};

function restart(){
	story="";
}

function getCPUText(inputString, callback) {

	var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE) {
           if(xmlhttp.status == 200){
               callback(xmlhttp.responseText);
           }
        }
    }

    xmlhttp.open("GET", "/words/?s="+encodeURI(inputString), true);
    xmlhttp.send();

}

</script>

<link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />
</body>
</html>
